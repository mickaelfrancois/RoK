<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Rok.Pages.ArtistPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Rok.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:common="using:Rok.Commons" 
    xmlns:tracks="using:Rok.Logic.ViewModels.Tracks" 
    xmlns:albums="using:Rok.Logic.ViewModels.Albums"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition x:Name="headerRow" 
                           Height="{ThemeResource headerRowHeight}" />
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.Background>
            <SolidColorBrush Color="{ThemeResource CardBackgroundFillColorDefault}"
                             Opacity="{StaticResource headerBackgroundOpacity}" />
        </Grid.Background>

        <Image x:Name="backdrop"
               Grid.RowSpan="2"
               Source="{x:Bind ViewModel.Backdrop,Mode=OneWay}"
               Opacity="0.20"
               Style="{StaticResource headerBackdrop}"
               Stretch="UniformToFill"
               IsHitTestVisible="False" />

        <!-- Header -->
        <Grid Padding="2">

            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="pictureColumn" 
                                  Width="{ThemeResource headerPictureColumnWidth}"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Style="{StaticResource headerPictureGrid}">
                <common:PictureControl x:Name="artistPicture" 
                                       Cover="{x:Bind ViewModel.Picture, Mode=OneWay}" 
                                       Style="{StaticResource headerPicture}"/>
                <Button x:Uid="selectPicture"
                        Style="{StaticResource headerPictureSelectButton}" 
                        Command="{x:Bind ViewModel.SelectPictureCommand}"/>
            </Grid>

            <RelativePanel x:Name="headerPanel" Grid.Column="1" Margin="6,0,0,0">
                <TextBlock x:Name="artistName" 
                           Text="{x:Bind ViewModel.Artist.Name, Mode=OneWay}" 
                           Style="{StaticResource headerTitleText}" />

                <Button x:Name="buttonCountry" RelativePanel.RightOf="artistName" RelativePanel.AlignVerticalCenterWith="artistName" Style="{StaticResource ButtonTextBlockStyle}" Visibility="{x:Bind ViewModel.Artist.CountryCode, Converter={StaticResource StringToVisibilityConverter}}" Command="{x:Bind ViewModel.ArtistsByCountryOpenCommand}" Margin="6,0,0,0" BorderBrush="Transparent" Background="Transparent" ToolTipService.ToolTip="{x:Bind ViewModel.Artist.CountryName}">
                    <Image Source="{x:Bind ViewModel.Artist.CountryCode, Converter={StaticResource CountryCodeToImageSourceConverter}}" Height="{ThemeResource countryFlagHeigh}"></Image>
                </Button>

                <TextBlock x:Name="year" 
                           RelativePanel.RightOf="buttonCountry" 
                           RelativePanel.AlignVerticalCenterWith="buttonCountry"
                           Text="{x:Bind ViewModel.ActiveYears}" 
                           Style="{StaticResource SubtitleTextBlockStyle}" 
                           FontSize="14"
                           Margin="10,-1,0,0" 
                           VerticalAlignment="Center"/>

                <HyperlinkButton x:Name="genreName" 
                                 Content="{x:Bind ViewModel.Artist.GenreName}" 
                                 RelativePanel.Below="artistName" 
                                 Command="{x:Bind ViewModel.GenreOpenCommand}"
                                 Style="{StaticResource headerGenreHyperlink}"                                 
                                 />

                <TextBlock x:Name="panelExtendedInfo" 
                           RelativePanel.Below="genreName"
                           Text="{x:Bind ViewModel.SubTitle}"
                           Style="{StaticResource headerText}"
                           />

                <TextBlock x:Name="panelStatsInfo" 
                           RelativePanel.Below="panelExtendedInfo"
                           Text="{x:Bind ViewModel.ListenStats}"
                           Style="{StaticResource headerText}"
                           />

                <CommandBar  RelativePanel.AlignBottomWithPanel="True" 
                             Style="{StaticResource headerCommandBar}">

                    <AppBarButton x:Uid="artistViewListen"
                                  Style="{StaticResource listenAppBarButtonStyle}"
                                  Command="{x:Bind ViewModel.ListenCommand}"/>

                    <AppBarToggleButton x:Uid="artistViewLike" 
                                        x:Name="artistAppBarLike" 
                                        Style="{StaticResource headerLikeButton}"                                        
                                        IsChecked="{x:Bind ViewModel.IsFavorite, Mode=OneWay}" 
                                        Command="{x:Bind ViewModel.ArtistFavoriteCommand}" />

                    <AppBarButton x:Uid="artistViewWebSite"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="World"
                                  Command="{x:Bind ViewModel.OpenOfficielSiteCommand}"
                                  Visibility="{x:Bind ViewModel.Artist.OfficialSiteUrl, Converter={StaticResource StringToVisibilityConverter}}" />

                    <AppBarButton x:Uid="artistViewBiography"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="Library"
                                  Click="ArtistViewBiography_Click"
                                  Visibility="{x:Bind ViewModel.Artist.Biography, Converter={StaticResource StringToVisibilityConverter}}" />

                    <AppBarButton x:Uid="artistViewLastFm"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="MusicInfo"
                                  Command="{x:Bind ViewModel.OpenLastFmPageCommand, Mode=OneWay}"
                                  Visibility="{x:Bind ViewModel.LastFmPageAvailable, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

                    <AppBarButton x:Uid="artistViewPlaylist"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="Add"
                                  Visibility="Collapsed"                                    
                                  IsEnabled="False"/>

                    <AppBarButton x:Uid="artistViewEdit"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="Edit"
                                  Visibility="Collapsed"
                                  IsEnabled="False" />
                </CommandBar>
            </RelativePanel>

            <Grid x:Name="biography" 
                  Grid.Column="1"                   
                  Visibility="Collapsed" 
                  Opacity="1"
                  Background="{ThemeResource CardBackgroundFillColorDefault}"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">

                <Border Background="{ThemeResource CardBackgroundFillColorDefault}"                        
                        Margin="6,0,0,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="{x:Bind ViewModel.Artist.Name, Mode=OneWay}"
                                   Style="{StaticResource headerTitleText}"/>

                        <ScrollViewer Grid.Row="1" Margin="0,0,0,6">
                            <TextBlock Text="{x:Bind ViewModel.Artist.Biography}" FontSize="12" TextWrapping="Wrap"/>
                        </ScrollViewer>

                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,0,0,4">
                            <Button x:Uid="commonClose" 
                                    x:Name="hideBiography"                                    
                                    Click="HideBiography_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

        </Grid>

        <!-- Content -->
        <Border Grid.Row="1"
                CornerRadius="12,12,0,0"
                Background="{ThemeResource CardBackgroundFillColorDefault}"
                Padding="24"
                Margin="4,0,4,4">
            <Pivot>
                <PivotItem x:Uid="artistViewTabAlbums">
                <common:GridViewExtended x:Name="grid" 
                                         ItemsSource="{x:Bind ViewModel.Albums}" 
                                         ContainerContentChanging="grid_ContainerContentChanging"  
                                         Margin="0" 
                                         ScrollViewer.VerticalScrollMode="Enabled" 
                                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="albums:AlbumViewModel">
                            <Grid Style="{StaticResource MainGridCoverStyle}">
                                <Border CornerRadius="10">
                                    <common:PictureControl Style="{StaticResource PictureCoverStyle}" Cover="{x:Bind Picture, Mode=OneWay}" x:Phase="2" PlayButtonVisibility="Visible" Command="{x:Bind ListenCommand}"/>
                                </Border>

                                <Grid Style="{StaticResource GridCoverBottomStyle}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="30"></RowDefinition>
                                        <RowDefinition Height="30"></RowDefinition>
                                    </Grid.RowDefinitions>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition Width="50"></ColumnDefinition>
                                    </Grid.ColumnDefinitions>

                                    <HyperlinkButton Grid.ColumnSpan="2" 
                                                     Content="{x:Bind Album.Name}" 
                                                     x:Phase="0" 
                                                     Command="{x:Bind AlbumOpenCommand}"  
                                                     Style="{StaticResource GridCoverBottomFirstLineStyle}" />

                                    <TextBlock Grid.Row="1" 
                                               Style="{StaticResource GridCoverBottomSecondLineStyle}" 
                                               Text="{x:Bind SubTitle, Mode=OneWay}" 
                                               x:Phase="1"/>

                                    <common:AnimatedButton Grid.Row="1" Grid.Column="1" 
                                                           HorizontalAlignment="Right" 
                                                           VerticalAlignment="Stretch" 
                                                           Margin="-15,0,0,0"            
                                                           Icon="{StaticResource HeartPath}" 
                                                           Color="{x:Bind IsFavorite, Converter={StaticResource FavoriteToColorConverter}, Mode=OneWay}"                                                                                                           
                                                           Command="{x:Bind AlbumFavoriteCommand}"
                                                           CommandParameter="{x:Bind IsFavorite, Converter={StaticResource BoolToInvertBoolConverter}, Mode=OneWay}" />
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </GridView.ItemTemplate>

                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Style="{StaticResource gridAlbumsWrapGrid}"/>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </common:GridViewExtended>
            </PivotItem>

            <PivotItem x:Uid="artistViewTabTracks">

                <Grid x:Name="tracks" Grid.Row="1">

                    <Grid.RowDefinitions>
                        <RowDefinition Height="{ThemeResource gridHeaderTracksHeight}"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>

                    <!-- Grid headers -->
                    <Grid Style="{StaticResource gridTracks}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="{ThemeResource gridHeaderTracksTitleColumnWidth}" x:Name="trackTitle"/>
                            <ColumnDefinition Width="{ThemeResource gridHeaderTracksAlbumColumnWidth}" x:Name="trackAlbum"/>
                            <ColumnDefinition Width="{ThemeResource gridHeaderTracksScoreColumnWidth}" x:Name="trackScore"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock x:Uid="gridHeaderTitle" 
                                   Grid.Column="0" 
                                   Style="{StaticResource gridHeaderTracksText}"                                   
                                   />
                        <TextBlock x:Uid="gridHeaderAlbum" 
                                   Grid.Column="1" 
                                   Style="{StaticResource gridHeaderTracksText}"
                                   />
                        <TextBlock x:Uid="gridHeaderScore" 
                                   Grid.Column="2" 
                                   Style="{StaticResource gridHeaderTracksText}"
                                   />
                    </Grid>

                    <ListView x:Name="tracksList"
                                            Grid.Row="1"       
                                            ContainerContentChanging="tracksList_ContainerContentChanging"
                                            ItemsSource="{x:Bind ViewModel.Tracks}" 
                                            ItemContainerStyle="{StaticResource tracksListViewItem}"
                                            SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="tracks:TrackViewModel">
                                <Grid Background="Transparent">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="{ThemeResource gridHeaderTracksTitleColumnWidth}" />
                                        <ColumnDefinition Width="{ThemeResource gridHeaderTracksAlbumColumnWidth}" />
                                        <ColumnDefinition Width="{ThemeResource gridHeaderTracksScoreColumnWidth}" />
                                    </Grid.ColumnDefinitions>

                                    <Grid.ContextFlyout>
                                        <MenuFlyout ShowMode="TransientWithDismissOnPointerMoveAway"
                                                    common:MenuFlyoutExtensions.PlaylistMenuService="{x:Bind PlaylistMenuService}"
                                                    common:MenuFlyoutExtensions.TrackId="{x:Bind Track.Id}">
                                            <MenuFlyoutItem x:Uid="trackFlyoutListen" 
                                                            Icon="Play"
                                                            Command="{x:Bind ListenCommand}" 
                                                            CommandParameter="{x:Bind}" />
                                            <MenuFlyoutItem x:Uid="trackFlyoutArtist" 
                                                            Icon="People"
                                                            Command="{x:Bind ArtistOpenCommand}" />
                                            <MenuFlyoutItem x:Uid="trackFlyoutTrack"
                                                            Icon="Audio"
                                                            Command="{x:Bind TrackOpenCommand}" />
                                            <MenuFlyoutSeparator />
                                            <MenuFlyoutItem x:Uid="trackFlyoutLyrics" 
                                                            Command="{x:Bind LyricsOpenCommand}" 
                                                            Visibility="{x:Bind LyricsExists, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE90B;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Grid.ContextFlyout>

                                    <StackPanel Grid.Column="0"
                                                Orientation="Horizontal">
                                        <TextBlock x:Name="RowIndexText"
                                                   Style="{StaticResource gridTracksRowIndexText}" />

                                        <HyperlinkButton Style="{StaticResource gridTracksTitleText}"
                                                         Command="{x:Bind ListenCommand}"
                                                         CommandParameter="{x:Bind}" />

                                        <HyperlinkButton x:Uid="lyricsTag"
                                                         Visibility="{x:Bind LyricsExists, Converter={StaticResource BoolToVisibilityConverter}}"
                                                         Style="{StaticResource gridTracksLyricsText}"
                                                         Command="{x:Bind LyricsOpenCommand}" />
                                    </StackPanel>

                                    <HyperlinkButton Grid.Column="1"                                                     
                                            Style="{StaticResource gridTracksAlbumText}"                                             
                                            Command="{x:Bind AlbumOpenCommand}" />

                                    <common:RatingControlLightControl Grid.Column="2" 
                                                                      Style="{StaticResource gridTracksScore}"
                                                                      RatingValue="{x:Bind Score, Mode=TwoWay}" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </PivotItem>
        </Pivot>
        </Border>
    </Grid>
</Page>
