<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="Rok.Pages.AlbumPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Rok.Pages"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:common="using:Rok.Commons"
      xmlns:tracks="using:Rok.Logic.ViewModels.Tracks"
      x:Name="albumPage"
      mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition x:Name="headerRow"
                           Height="{ThemeResource headerRowHeight}" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid.Background>
            <SolidColorBrush Color="{ThemeResource CardBackgroundFillColorDefault}"
                             Opacity="{StaticResource headerBackgroundOpacity}" />
        </Grid.Background>

        <Image x:Name="backdrop"
               Grid.RowSpan="2"
               Source="{x:Bind ViewModel.Backdrop,Mode=OneWay}"
               Opacity="0.20"
               Style="{StaticResource headerBackdrop}"
               Stretch="UniformToFill"
               IsHitTestVisible="False" />

        <!-- Header -->
        <Grid Padding="2">

            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="pictureColumn"
                                  Width="{ThemeResource headerPictureColumnWidth}" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Grid Style="{StaticResource headerPictureGrid}">
                <common:PictureControl x:Name="artistPicture"
                                       Cover="{x:Bind ViewModel.Picture, Mode=OneWay}"
                                       Style="{StaticResource headerPicture}" />
                <Button x:Uid="selectPicture"
                        Style="{StaticResource headerPictureSelectButton}"
                        Command="{x:Bind ViewModel.SelectPictureCommand}" />
            </Grid>

            <RelativePanel Grid.Column="1"
                           Margin="6,0,0,0">
                <TextBlock x:Name="albumName"
                           Text="{x:Bind ViewModel.Album.Name, Mode=OneWay}"
                           Style="{StaticResource headerTitleText}" />

                <HyperlinkButton x:Name="artistName"
                                 Content="{x:Bind ViewModel.Album.ArtistName}"
                                 RelativePanel.Below="albumName"
                                 Command="{x:Bind ViewModel.ArtistOpenCommand}"
                                 Style="{StaticResource headerGenreHyperlink}" />

                <Button x:Name="buttonCountry"
                        RelativePanel.AlignVerticalCenterWith="artistName"
                        RelativePanel.RightOf="artistName"
                        Style="{StaticResource ButtonTextBlockStyle}"
                        Visibility="{x:Bind ViewModel.Album.CountryCode, Converter={StaticResource StringToVisibilityConverter}}"
                        Command="{x:Bind ViewModel.OpenArtistsByCountryCommand}"
                        BorderBrush="Transparent"
                        Background="Transparent"
                        ToolTipService.ToolTip="{x:Bind ViewModel.Album.CountryName}">
                    <Image Source="{x:Bind ViewModel.Album.CountryCode, Converter={StaticResource CountryCodeToImageSourceConverter}}"
                           Height="{ThemeResource countryFlagHeigh}"></Image>
                </Button>

                <StackPanel x:Name="albumType"
                            RelativePanel.RightOf="albumName"
                            RelativePanel.AlignVerticalCenterWith="albumName"
                            Orientation="Horizontal"
                            Margin="4,0,0,0">
                    <Border Visibility="{x:Bind ViewModel.Album.IsLive, Mode=TwoWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            Background="DarkCyan"
                            CornerRadius="1"
                            Margin="0,0,10,0">
                        <TextBlock Text="Live"
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   Foreground="White"
                                   FontSize="9"
                                   Padding="4,0,4,0"/>
                    </Border>

                    <Border Visibility="{x:Bind ViewModel.Album.IsBestOf, Mode=TwoWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            Background="DarkBlue"
                            CornerRadius="1"
                            Margin="0,0,10,0">
                        <TextBlock Text="Bestof"
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   Foreground="White"
                                   FontSize="9"
                                   Padding="4,0,4,0"/>
                    </Border>

                    <Border Visibility="{x:Bind ViewModel.Album.IsCompilation, Mode=TwoWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            Background="DarkViolet"
                            CornerRadius="1"
                            Margin="0,0,10,0">
                        <TextBlock Text="Compilation"
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   Foreground="White"
                                   FontSize="9"
                                   Padding="4,0,4,0"/>
                    </Border>
                </StackPanel>

                <HyperlinkButton x:Name="genreName"
                                 Visibility="Collapsed"
                                 Content="{x:Bind ViewModel.Album.GenreName}"
                                 RelativePanel.Below="artistName"
                                 Command="{x:Bind ViewModel.GenreOpenCommand}"
                                 Style="{StaticResource headerGenreHyperlink}" />

                <TextBlock x:Name="panelExtendedInfo"
                           RelativePanel.Below="genreName"
                           Style="{StaticResource headerText}"
                           Text="{x:Bind ViewModel.SubTitle}" />

                <StackPanel x:Name="panelStatsInfo"
                            RelativePanel.Below="panelExtendedInfo"
                            Orientation="Horizontal"
                            Visibility="{x:Bind ViewModel.Album.ListenCount, Converter={StaticResource IntToVisibilityConverter}}">
                    <TextBlock x:Uid="AlbumViewListenCount"
                               Margin="0,0,4,0"
                               FontSize="12"></TextBlock>
                    <TextBlock Text="{x:Bind ViewModel.Album.ListenCount}"
                               FontSize="12"></TextBlock>
                    <TextBlock x:Uid="AlbumViewListenCountTimes"
                               Margin="2,0,0,0"
                               FontSize="12"></TextBlock>

                    <TextBlock x:Uid="AlbumViewLastListen"
                               Margin="0,0,2,0"
                               FontSize="12"></TextBlock>
                    <TextBlock Text="{x:Bind ViewModel.Album.LastListen}"
                               FontSize="12"></TextBlock>
                </StackPanel>

                <CommandBar  RelativePanel.AlignBottomWithPanel="True"
                             Style="{StaticResource headerCommandBar}">

                    <AppBarButton x:Uid="albumViewListen"
                                  Style="{StaticResource listenAppBarButtonStyle}"
                                  Command="{x:Bind ViewModel.ListenCommand}" />

                    <AppBarToggleButton x:Uid="albumViewLike"
                                        x:Name="albumAppBarLike"
                                        Style="{StaticResource headerLikeButton}"
                                        IsChecked="{x:Bind ViewModel.IsFavorite, Mode=OneWay}"
                                        Command="{x:Bind ViewModel.AlbumFavoriteCommand}" />

                    <AppBarButton x:Uid="albumViewLastFm"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="MusicInfo"
                                  Command="{x:Bind ViewModel.OpenLastFmPageCommand, Mode=OneWay}"
                                  Visibility="{x:Bind ViewModel.LastFmPageAvailable, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

                    <AppBarButton x:Uid="albumViewBiography"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="Library"
                                  Visibility="Collapsed" />

                    <AppBarButton x:Uid="albumViewPlaylist"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="Add"
                                  Visibility="Collapsed" />

                    <AppBarButton x:Uid="albumViewEdit"
                                  Style="{StaticResource headerGenericButton}"
                                  Icon="Edit"
                                  Command="{x:Bind ViewModel.EditAlbumCommand}" />

                </CommandBar>

            </RelativePanel>
        </Grid>

        <!-- Tracks grid -->
        <Grid x:Name="tracks"
              CornerRadius="12,12,0,0"
              Padding="24"
              Background="{ThemeResource CardBackgroundFillColorDefault}"
              Grid.Row="1"
              Margin="4,0,4,4"
              ScrollViewer.VerticalScrollBarVisibility="Auto">

            <Grid.RowDefinitions>
                <RowDefinition Height="{ThemeResource gridHeaderTracksHeight}" />
                <RowDefinition />
            </Grid.RowDefinitions>

            <!-- Grid headers -->
            <Grid Style="{StaticResource gridTracks}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="{ThemeResource gridHeaderTracksTitleColumnWidth}" />
                    <ColumnDefinition Width="{ThemeResource gridHeaderTracksArtistColumnWidth}" />
                    <ColumnDefinition Width="{ThemeResource gridHeaderTracksScoreColumnWidth}" />
                </Grid.ColumnDefinitions>

                <TextBlock x:Uid="gridHeaderTitle"
                           Grid.Column="0"
                           Style="{StaticResource gridHeaderTracksText}" />
                <TextBlock x:Uid="gridHeaderArtist"
                           Grid.Column="1"
                           Visibility="{x:Bind ViewModel.Album.IsCompilation, Converter={StaticResource BoolToVisibilityConverter}}"
                           Style="{StaticResource gridHeaderTracksText}" />
                <TextBlock x:Uid="gridHeaderScore"
                           Grid.Column="2"
                           Style="{StaticResource gridHeaderTracksText}" />
            </Grid>

            <ListView x:Name="tracksList"
                      Grid.Row="1"
                      ContainerContentChanging="tracksList_ContainerContentChanging"
                      ItemsSource="{x:Bind ViewModel.Tracks}"
                      ItemContainerStyle="{StaticResource tracksListViewItem}"
                      SelectionMode="Single">

                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="tracks:TrackViewModel">
                        <Grid Background="Transparent">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="{ThemeResource gridHeaderTracksTitleColumnWidth}" />
                                <ColumnDefinition Width="{ThemeResource gridHeaderTracksArtistColumnWidth}" />
                                <ColumnDefinition Width="{ThemeResource gridHeaderTracksScoreColumnWidth}" />
                            </Grid.ColumnDefinitions>

                            <Grid.ContextFlyout>
                                <MenuFlyout ShowMode="TransientWithDismissOnPointerMoveAway"
                                            common:MenuFlyoutExtensions.PlaylistMenuService="{x:Bind PlaylistMenuService}"
                                            common:MenuFlyoutExtensions.TrackId="{x:Bind Track.Id}">
                                    <MenuFlyoutItem x:Uid="trackFlyoutListen"
                                                    Icon="Play"
                                                    Command="{x:Bind ListenCommand}"
                                                    CommandParameter="{x:Bind}" />
                                    <MenuFlyoutItem x:Uid="trackFlyoutArtist"
                                                    Icon="People"
                                                    Command="{x:Bind ArtistOpenCommand}" />
                                    <MenuFlyoutItem x:Uid="trackFlyoutTrack"
                                                    Icon="Audio"
                                                    Command="{x:Bind TrackOpenCommand}" />
                                    <MenuFlyoutSeparator />
                                    <MenuFlyoutItem x:Uid="trackFlyoutLyrics"
                                                    Command="{x:Bind LyricsOpenCommand}"
                                                    Visibility="{x:Bind LyricsExists, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE90B;" />
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                </MenuFlyout>
                            </Grid.ContextFlyout>

                            <StackPanel Grid.Column="0"
                                        Orientation="Horizontal">

                                <TextBlock x:Name="RowIndexText"
                                           Style="{StaticResource gridTracksRowIndexText}" />

                                <HyperlinkButton Style="{StaticResource gridTracksTitleText}"
                                                 Command="{x:Bind ListenCommand}"
                                                 CommandParameter="{x:Bind}" />

                                <HyperlinkButton x:Uid="lyricsTag"
                                                 Visibility="{x:Bind LyricsExists, Converter={StaticResource BoolToVisibilityConverter}}"
                                                 Style="{StaticResource gridTracksLyricsText}"
                                                 Command="{x:Bind LyricsOpenCommand}" />
                            </StackPanel>

                            <HyperlinkButton Grid.Column="1"
                                             Visibility="{x:Bind Track.IsAlbumCompilation, Converter={StaticResource BoolToVisibilityConverter}}"
                                             Style="{StaticResource gridTracksArtistText}"
                                             Command="{x:Bind ArtistOpenCommand}" />

                            <common:RatingControlLightControl Grid.Column="2"
                                                              Style="{StaticResource gridTracksScore}"
                                                              RatingValue="{x:Bind Score, Mode=TwoWay}" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</Page>
