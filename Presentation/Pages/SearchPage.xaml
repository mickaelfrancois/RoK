<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="Rok.Pages.SearchPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Rok.Pages"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:common="using:Rok.Commons"
      xmlns:b="using:Rok.Logic.ViewModels.Albums"
      xmlns:a="using:Rok.Logic.ViewModels.Artists"
      xmlns:track="using:Rok.Logic.ViewModels.Tracks"
      mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal"
                    Margin="4,6,0,6">
            
            <SymbolIcon Symbol="Find"
                        Margin="4,0,4,0" />
            
            <TextBlock x:Uid="searchViewTitle"
                   Style="{StaticResource HeaderStyle}" />
        </StackPanel>
        
        <Line Stretch="Fill"
              Stroke="{StaticResource AppBarSeparatorForegroundThemeBrush}"
              VerticalAlignment="Bottom"
              X2="100" />

        <ScrollViewer VerticalScrollBarVisibility="Visible"
                      Grid.Row="1"
                      Margin="0,10,10,10">
            <StackPanel Orientation="Vertical">

                <!-- Artists -->
                <GridViewHeaderItem x:Name="searchArtistHeader"
                                    FontSize="24"
                                    FontWeight="Bold"
                                    HorizontalAlignment="Left">
                    <GridViewHeaderItem.Content>
                        <StackPanel Orientation="Horizontal">
                            <SymbolIcon Symbol="People"
                                        Margin="4,0,4,0" />
                            <TextBlock x:Uid="searchArtistHeader"></TextBlock>
                        </StackPanel>
                    </GridViewHeaderItem.Content>
                </GridViewHeaderItem>
                <common:GridViewExtended x:Name="artistsGrid"
                                         x:Load="{x:Bind ArtistCount, Converter={StaticResource IntToBoolConverter}}"
                                         ItemsSource="{x:Bind ArtistsViewModel.ViewModels}"
                                         ContainerContentChanging="grid_ContainerContentChanging"
                                         Margin="0"
                                         ScrollViewer.VerticalScrollMode="Enabled"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto">

                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="a:ArtistViewModel">
                            <Grid Style="{StaticResource MainGridCoverStyle}">
                                <Border CornerRadius="10">
                                    <common:PictureControl Style="{StaticResource PictureCoverStyle}"
                                                           Cover="{x:Bind Picture, Mode=OneWay}"
                                                           x:Phase="2"
                                                           PlayButtonVisibility="Visible"
                                                           Command="{x:Bind ListenCommand}" />
                                </Border>

                                <Grid Style="{StaticResource GridCoverBottomStyle}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="{ThemeResource gridListFirstRowHeight}" />
                                        <RowDefinition Height="{ThemeResource gridListSecondRowHeight}" />
                                    </Grid.RowDefinitions>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                    </Grid.ColumnDefinitions>

                                    <HyperlinkButton Grid.ColumnSpan="2"
                                                     Content="{x:Bind Artist.Name}"
                                                     x:Phase="0"
                                                     Command="{x:Bind ArtistOpenCommand}"
                                                     Style="{StaticResource GridCoverBottomFirstLineStyle}" />

                                    <TextBlock Grid.Row="1"
                                               Style="{StaticResource GridCoverBottomSecondLineStyle}"
                                               Text="{x:Bind SubTitle, Mode=OneWay}"
                                               x:Phase="1" />

                                    <common:AnimatedButton Grid.Row="1"
                                                           Grid.Column="1"
                                                           HorizontalAlignment="Right"
                                                           VerticalAlignment="Stretch"
                                                           Margin="-15,0,0,0"
                                                           x:Phase="1"
                                                           Icon="{StaticResource HeartPath}"
                                                           Color="{x:Bind IsFavorite, Converter={StaticResource FavoriteToColorConverter}, Mode=OneWay}"
                                                           Command="{x:Bind ArtistFavoriteCommand}"
                                                           CommandParameter="{x:Bind IsFavorite, Converter={StaticResource BoolToInvertBoolConverter}, Mode=OneWay}" />
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </GridView.ItemTemplate>

                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal"
                                           ItemHeight="310"
                                           ItemWidth="310"
                                           Margin="0,0,2,2"></ItemsWrapGrid>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </common:GridViewExtended>

                <!-- Albums -->
                <GridViewHeaderItem x:Name="searchAlbumHeader"
                                    FontSize="24"
                                    FontWeight="Bold"
                                    HorizontalAlignment="Left">
                    <GridViewHeaderItem.Content>
                        <StackPanel Orientation="Horizontal">
                            <FontIcon Glyph="&#xe93c;"
                                      FontFamily="Segoe Fluent Icons"
                                      Margin="4,0,4,0" />
                            <TextBlock x:Uid="searchAlbumHeader"></TextBlock>
                        </StackPanel>
                    </GridViewHeaderItem.Content>
                </GridViewHeaderItem>
                <common:GridViewExtended x:Name="albumsGrid"
                                         x:Load="{x:Bind AlbumCount, Converter={StaticResource IntToBoolConverter}}"
                                         ItemsSource="{x:Bind AlbumsViewModel.ViewModels}"
                                         ContainerContentChanging="grid_ContainerContentChanging"
                                         Margin="0"
                                         ScrollViewer.VerticalScrollMode="Enabled"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto">

                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="b:AlbumViewModel">
                            <Grid Style="{StaticResource MainGridCoverStyle}">
                                <Border CornerRadius="10">
                                    <common:PictureControl Style="{StaticResource PictureCoverStyle}"
                                                           Cover="{x:Bind Picture, Mode=OneWay}"
                                                           x:Phase="2"
                                                           PlayButtonVisibility="Visible"
                                                           Command="{x:Bind ListenCommand}" />
                                </Border>

                                <Grid Style="{StaticResource GridCoverBottomStyle}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="{ThemeResource gridListFirstRowHeight}" />
                                        <RowDefinition Height="{ThemeResource gridListSecondRowHeight}" />
                                    </Grid.RowDefinitions>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                    </Grid.ColumnDefinitions>

                                    <HyperlinkButton Grid.ColumnSpan="2"
                                                     Content="{x:Bind Album.Name}"
                                                     x:Phase="0"
                                                     Command="{x:Bind AlbumOpenCommand}"
                                                     Style="{StaticResource GridCoverBottomFirstLineStyle}" />

                                    <TextBlock Grid.Row="1"
                                               Style="{StaticResource GridCoverBottomSecondLineStyle}"
                                               Text="{x:Bind SubTitle, Mode=OneWay}"
                                               x:Phase="1" />

                                    <common:AnimatedButton Grid.Row="1"
                                                           Grid.Column="1"
                                                           HorizontalAlignment="Right"
                                                           VerticalAlignment="Stretch"
                                                           Margin="-15,0,0,0"
                                                           x:Phase="1"
                                                           Icon="{StaticResource HeartPath}"
                                                           Color="{x:Bind IsFavorite, Converter={StaticResource FavoriteToColorConverter}, Mode=OneWay}"
                                                           Command="{x:Bind AlbumFavoriteCommand}"
                                                           CommandParameter="{x:Bind IsFavorite, Converter={StaticResource BoolToInvertBoolConverter}, Mode=OneWay}" />
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </GridView.ItemTemplate>

                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal"
                                           ItemHeight="310"
                                           ItemWidth="310"
                                           Margin="0,0,2,2"></ItemsWrapGrid>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </common:GridViewExtended>

                <!-- Tracks -->
                <GridViewHeaderItem x:Name="searchTrackHeader"
                                    FontSize="24"
                                    FontWeight="Bold"
                                    HorizontalAlignment="Left">
                    <GridViewHeaderItem.Content>
                        <StackPanel Orientation="Horizontal">
                            <SymbolIcon Symbol="Audio"
                                        Margin="4,0,4,0" />
                            <TextBlock x:Uid="searchTrackHeader"></TextBlock>
                        </StackPanel>
                    </GridViewHeaderItem.Content>
                </GridViewHeaderItem>

                <Grid Style="{StaticResource gridList}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="{ThemeResource gridHeaderTracksHeight}" />
                        <RowDefinition />
                    </Grid.RowDefinitions>

                    <Grid Style="{StaticResource gridTracks}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="{ThemeResource gridHeaderTracksTitleColumnWidth}"
                                              x:Name="trackTitle" />
                            <ColumnDefinition Width="{ThemeResource gridHeaderTracksArtistColumnWidth}"
                                              x:Name="trackArtist" />
                            <ColumnDefinition Width="{ThemeResource gridHeaderTracksAlbumColumnWidth}"
                                              x:Name="trackAlbum" />
                            <ColumnDefinition Width="{ThemeResource gridHeaderTracksScoreColumnWidth}"
                                              x:Name="trackScore" />
                        </Grid.ColumnDefinitions>

                        <TextBlock x:Uid="gridHeaderTitle"
                                   Grid.Column="0"
                                   Style="{StaticResource gridHeaderTracksText}" />
                        <TextBlock x:Uid="gridHeaderArtist"
                                   Grid.Column="1"
                                   Style="{StaticResource gridHeaderTracksText}" />
                        <TextBlock x:Uid="gridHeaderAlbum"
                                   Grid.Column="2"
                                   Style="{StaticResource gridHeaderTracksText}" />
                        <TextBlock x:Uid="gridHeaderScore"
                                   Grid.Column="3"
                                   Style="{StaticResource gridHeaderTracksText}" />
                    </Grid>

                    <common:ListViewExtended x:Name="tracksList"
                                             Grid.Row="1"
                                             ItemContainerStyle="{StaticResource tracksListViewItem}"
                                             x:Load="{x:Bind TrackCount, Converter={StaticResource IntToBoolConverter}}"
                                             ItemsSource="{x:Bind TracksViewModel.ViewModels}">

                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="track:TrackViewModel">
                                <Grid Background="Transparent">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="{ThemeResource gridHeaderTracksTitleColumnWidth}" />
                                        <ColumnDefinition Width="{ThemeResource gridHeaderTracksArtistColumnWidth}" />
                                        <ColumnDefinition Width="{ThemeResource gridHeaderTracksAlbumColumnWidth}" />
                                        <ColumnDefinition Width="{ThemeResource gridHeaderTracksScoreColumnWidth}" />
                                    </Grid.ColumnDefinitions>

                                    <Grid.ContextFlyout>
                                        <MenuFlyout ShowMode="TransientWithDismissOnPointerMoveAway">
                                            <MenuFlyoutItem x:Uid="trackFlyoutListen"
                                                            Icon="Play"
                                                            Command="{x:Bind ListenCommand}"
                                                            CommandParameter="{x:Bind}" />
                                            <MenuFlyoutItem x:Uid="trackFlyoutArtist"
                                                            Icon="People"
                                                            Command="{x:Bind ArtistOpenCommand}" />
                                            <MenuFlyoutItem x:Uid="trackFlyoutAlbum"
                                                            Command="{x:Bind AlbumOpenCommand}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE93C;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutSeparator />
                                            <MenuFlyoutItem x:Uid="trackFlyoutLyrics"
                                                            Command="{x:Bind LyricsOpenCommand}"
                                                            Visibility="{x:Bind LyricsExists, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE90B;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Grid.ContextFlyout>

                                    <StackPanel Grid.Column="0"
                                                Orientation="Horizontal">
                                        <HyperlinkButton Style="{StaticResource gridTracksTitleText}"
                                                         Command="{x:Bind ListenCommand}"
                                                         CommandParameter="{x:Bind}" />

                                        <HyperlinkButton x:Uid="lyricsTag"
                                                         Visibility="{x:Bind LyricsExists, Converter={StaticResource BoolToVisibilityConverter}}"
                                                         Style="{StaticResource gridTracksLyricsText}"
                                                         Command="{x:Bind LyricsOpenCommand}" />
                                    </StackPanel>

                                    <HyperlinkButton Grid.Column="1"
                                                     Style="{StaticResource gridTracksArtistText}"
                                                     Command="{x:Bind ArtistOpenCommand}" />

                                    <HyperlinkButton Grid.Column="2"
                                                     Style="{StaticResource gridTracksAlbumText}"
                                                     Command="{x:Bind AlbumOpenCommand}" />

                                    <common:RatingControlLightControl Grid.Column="3"
                                                                      Style="{StaticResource gridTracksScore}"
                                                                      RatingValue="{x:Bind Score, Mode=TwoWay}" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </common:ListViewExtended>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
