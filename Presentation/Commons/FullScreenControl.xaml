<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Rok.Commons.FullScreenControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Rok.Commons"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="Black">

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="visualChangeGroup">
                <VisualState x:Name="changeTrackAnimation1">
                    <Storyboard>
                        <RepositionThemeAnimation  Storyboard.TargetName="title" FromHorizontalOffset="-400"></RepositionThemeAnimation>
                        <RepositionThemeAnimation  Storyboard.TargetName="artist" FromHorizontalOffset="-400"></RepositionThemeAnimation>
                        <RepositionThemeAnimation  Storyboard.TargetName="cover" FromHorizontalOffset="-400"></RepositionThemeAnimation>
                        <RepositionThemeAnimation  Storyboard.TargetName="score" FromHorizontalOffset="400"></RepositionThemeAnimation>
                    </Storyboard>
                </VisualState>
                <VisualState x:Name="changeTrackAnimation2">
                    <Storyboard>
                        <RepositionThemeAnimation  Storyboard.TargetName="title" FromVerticalOffset="400"></RepositionThemeAnimation>
                        <RepositionThemeAnimation  Storyboard.TargetName="artist" FromVerticalOffset="-400"></RepositionThemeAnimation>
                        <RepositionThemeAnimation  Storyboard.TargetName="cover" FromVerticalOffset="-400"></RepositionThemeAnimation>
                        <RepositionThemeAnimation  Storyboard.TargetName="score" FromVerticalOffset="-400"></RepositionThemeAnimation>
                    </Storyboard>
                </VisualState>
                <VisualState x:Name="changeTrackAnimation3">
                    <Storyboard>
                        <DoubleAnimation Storyboard.TargetName="title" From="0" To="1" Storyboard.TargetProperty="Opacity" Duration="0:0:3"></DoubleAnimation>
                        <DoubleAnimation Storyboard.TargetName="artist" From="0" To="1" Storyboard.TargetProperty="Opacity" Duration="0:0:3"></DoubleAnimation>
                        <DoubleAnimation Storyboard.TargetName="cover" From="0" To="1" Storyboard.TargetProperty="Opacity" Duration="0:0:3"></DoubleAnimation>
                        <DoubleAnimation Storyboard.TargetName="score" From="0" To="1" Storyboard.TargetProperty="Opacity" Duration="0:0:3"></DoubleAnimation>
                    </Storyboard>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <local:BackdropControl Source="{x:Bind PlayerViewModel.CurrentArtist.Backdrop, Mode=OneWay}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"></local:BackdropControl>

        <!-- Lyrics raw -->
        <Grid Margin="0,85,00,130" Opacity="0.7" Visibility="{x:Bind PlayerViewModel.CurrentTrack.LyricsExists, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <ScrollViewer Background="Black"
                          Visibility="{Binding ElementName=displayLyricsToggle, Mode=OneWay, Path=IsChecked}"
                          HorizontalContentAlignment="Stretch">
                <TextBlock x:Name="LyricsStatic"
                           Foreground="White"
                           Text="{x:Bind PlayerViewModel.PlainLyrics, Mode=OneWay}"
                           FontSize="16"
                           VerticalAlignment="Stretch"
                           HorizontalAlignment="Center"
                           HorizontalTextAlignment="Center"
                           TextAlignment="Center"
                           ScrollViewer.VerticalScrollBarVisibility="Visible"
                           ScrollViewer.VerticalScrollMode="Auto" />
            </ScrollViewer>
        </Grid>

        <!-- Top line -->
        <Grid Margin="0,10,0,0" VerticalAlignment="Top" Height="75">
            <Grid.Background>
                <SolidColorBrush Color="Black" Opacity="0.3"></SolidColorBrush>
            </Grid.Background>

            <Grid.RowDefinitions>
                <RowDefinition Height="50"></RowDefinition>
                <RowDefinition Height="20"></RowDefinition>
            </Grid.RowDefinitions>

            <!-- Remplacé StackPanel par Grid pour centrer le 1er CommandBar et aligner le 2nd à droite -->
            <Grid VerticalAlignment="Top" HorizontalAlignment="Stretch" Padding="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <CommandBar Grid.Column="0"
                            Grid.ColumnSpan="2"
                            Background="Transparent"
                            Height="50"
                            VerticalAlignment="Center"
                            OverflowButtonVisibility="Collapsed"
                            HorizontalAlignment="Center"
                            VerticalContentAlignment="Center">
                    <AppBarButton Icon="Previous"
                                  Command="{x:Bind PlayerViewModel.SkipPreviousCommand}"
                                  IsEnabled="{x:Bind PlayerViewModel.CanSkipPrevious, Mode=OneWay}"
                                  RequestedTheme="Dark"
                                  VerticalAlignment="Stretch"
                                  Height="65"
                                  Width="40"
                                  Margin="0,0,0,0" />

                    <AppBarButton RequestedTheme="Dark"
                                  IsCompact="False"
                                  Style="{StaticResource RoundAppBarButtonStyle}"
                                  Command="{x:Bind PlayerViewModel.TogglePlayPauseCommand}">
                        <SymbolIcon Symbol="{x:Bind PlayerViewModel.PlaybackState, Mode=OneWay, Converter={StaticResource PlaybackStateToButtonIconConverter}}" />
                    </AppBarButton>

                    <AppBarButton Icon="Next"
                                  Command="{x:Bind PlayerViewModel.SkipNextCommand}"
                                  IsEnabled="{x:Bind PlayerViewModel.CanSkipNext, Mode=OneWay}"
                                  RequestedTheme="Dark"
                                  VerticalAlignment="Stretch"
                                  Height="65"
                                  Width="40"
                                  Margin="10,0,0,0" />

                    <AppBarSeparator />
                </CommandBar>

                <CommandBar Grid.Column="1"
                            Background="Transparent"
                            Height="50"
                            VerticalAlignment="Center"
                            OverflowButtonVisibility="Collapsed"
                            HorizontalAlignment="Right"
                            HorizontalContentAlignment="Right"
                            VerticalContentAlignment="Center">

                    <AppBarButton x:Name="volume"
                                  RequestedTheme="Dark"
                                  IsCompact="False"
                                  Style="{StaticResource AppBarButtonRevealStyle}">
                        <FontIcon FontFamily="Segoe MDL2 Assets"
                                  Glyph="{x:Bind PlayerViewModel.Volume, Mode=OneWay, Converter={StaticResource VolumeToGlyphConverter}}" />
                        <AppBarButton.Flyout>
                            <Flyout>
                                <StackPanel Orientation="Horizontal"
                                            VerticalAlignment="Center">
                                    <Button Margin="0,0,4,0"
                                            Command="{x:Bind PlayerViewModel.MuteCommand}"
                                            Background="Transparent">
                                        <FontIcon FontFamily="Segoe MDL2 Assets"
                                                  Glyph="{x:Bind PlayerViewModel.Volume, Mode=OneWay, Converter={StaticResource VolumeToGlyphConverter}}" />
                                    </Button>
                                    <Slider Width="200"
                                            Value="{x:Bind PlayerViewModel.Volume, Mode=TwoWay}"
                                            Minimum="0"
                                            Maximum="100" />
                                </StackPanel>
                            </Flyout>
                        </AppBarButton.Flyout>
                    </AppBarButton>

                    <AppBarButton RequestedTheme="Dark"
                                  IsCompact="False"
                                  Icon="MusicInfo"
                                  Style="{StaticResource AppBarButtonRevealStyle}"
                                  Command="{x:Bind PlayerViewModel.OpenListeningCommand}">
                        <ToolTipService.ToolTip>
                            <TextBlock x:Uid="PlayerFullScreenCurrentListeningToolTips" />
                        </ToolTipService.ToolTip>
                    </AppBarButton>

                    <AppBarToggleButton x:Name="displayLyricsToggle"
                                        Icon="Audio"
                                        RequestedTheme="Dark"
                                        Style="{StaticResource AppBarToggleButtonRevealStyle}"
                                        Visibility="{x:Bind PlayerViewModel.LyricsExist, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ToolTipService.ToolTip>
                            <TextBlock x:Uid="PlayerFullScreenLyricsToolTips" />
                        </ToolTipService.ToolTip>
                    </AppBarToggleButton>

                    <AppBarButton RequestedTheme="Dark"
                                  Icon="BackToWindow"
                                  Style="{StaticResource AppBarButtonRevealStyle}"
                                  Command="{x:Bind PlayerViewModel.FullscreenCommand}">
                        <ToolTipService.ToolTip>
                            <TextBlock x:Uid="PlayerFullScreenToolTips" />
                        </ToolTipService.ToolTip>
                    </AppBarButton>
                </CommandBar>
            </Grid>


            <Grid Grid.Row="1" Height="18" VerticalAlignment="Bottom" HorizontalAlignment="Center" Width="500" Margin="0">
                <TextBlock Text="{x:Bind PlayerViewModel.ListenDurationStr, Mode=OneWay}" FontSize="14" Foreground="White"></TextBlock>
                <ProgressBar Margin="6,0,6,0" Width="400" VerticalAlignment="Center" Foreground="Green" RequestedTheme="Dark" Minimum="0" Maximum="100"  Value="{x:Bind PlayerViewModel.Progression, Mode=OneWay}"></ProgressBar>
                <TextBlock Text="{x:Bind PlayerViewModel.DurationTotalStr, Mode=OneWay}" FontSize="14" HorizontalAlignment="Right" Foreground="White"></TextBlock>
            </Grid>
        </Grid>

        <!-- Bottom line -->
        <Grid Margin="0,0,0,30" VerticalAlignment="Bottom" Height="100">
            <Grid.Background>
                <SolidColorBrush Color="Black" Opacity="0.7"></SolidColorBrush>
            </Grid.Background>
        </Grid>


        <!-- Lyrics -->
        <Grid Margin="0,0,0,140" VerticalAlignment="Bottom" Height="110" Visibility="{x:Bind PlayerViewModel.IsSynchronizedLyrics, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <ListBox ItemsSource="{x:Bind PlayerViewModel.Lyrics, Mode=OneWay}"  SelectedItem="{x:Bind PlayerViewModel.CurrentLyric, Mode=OneWay}" Foreground="White" FontSize="26" ScrollViewer.VerticalScrollBarVisibility="Hidden" ScrollViewer.HorizontalScrollBarVisibility="Hidden" SelectionChanged="ListBox_SelectionChanged" >
                <ListBox.Background>
                    <SolidColorBrush Color="Black" Opacity="0.7"></SolidColorBrush>
                </ListBox.Background>

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock x:Name="ContentItem" Text="{Binding Lyric, Mode=OneWay}" TextWrapping="Wrap" Foreground="Gray"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>

                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Grid>
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup x:Name="CommonStates">
                                                <VisualState x:Name="Normal"/>
                                            </VisualStateGroup>
                                            <VisualStateGroup x:Name="SelectionStates">
                                                <VisualState x:Name="Unselected">
                                                    <Storyboard>
                                                        <ColorAnimation Duration="0:0:1" Storyboard.TargetName="ContentItem" Storyboard.TargetProperty="(Foreground).(SolidColorBrush.Color)" To="#595959"/>
                                                        <DoubleAnimation Duration="0:0:1" Storyboard.TargetName="ContentItem" EnableDependentAnimation="True"  To="25" Storyboard.TargetProperty="FontSize"/>
                                                    </Storyboard>
                                                </VisualState>
                                                <VisualState x:Name="SelectedUnfocused">
                                                    <Storyboard>
                                                        <ColorAnimation Duration="0:0:1" Storyboard.TargetName="ContentItem" Storyboard.TargetProperty="(Foreground).(SolidColorBrush.Color)" To="White"/>
                                                        <DoubleAnimation Duration="0:0:1" Storyboard.TargetName="ContentItem" EnableDependentAnimation="True"  To="30" Storyboard.TargetProperty="FontSize"/>
                                                    </Storyboard>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>
                                        <TextBlock x:Name="ContentItem" HorizontalAlignment="Center" Text="{Binding Lyric, Mode=OneWay}" FontSize="25" TextWrapping="Wrap" Foreground="Gray"/>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </Grid>

        <Grid>
            <Border x:Name="cover" HorizontalAlignment="Left" Margin="60,0,0,10" VerticalAlignment="Bottom" Height="256" Width="256" Padding="6" BorderBrush="LightGray" BorderThickness="1" Background="White">
                <Image Width="240" Height="240" Source="{x:Bind PlayerViewModel.CurrentAlbum.Picture, Mode=OneWay}" Stretch="UniformToFill" VerticalAlignment="Top"/>
            </Border>

            <Grid x:Name="trackInfo">
                <TextBlock x:Name="title" Text="{x:Bind PlayerViewModel.CurrentTrack.Title, Mode=OneWay}" VerticalAlignment="Bottom" Margin="340, 0,0,80" FontSize="30"  Foreground="#FF42CB0F" HorizontalAlignment="Left"  TextWrapping="NoWrap"   Width="auto" FontWeight="Bold" />
                <TextBlock x:Name="artist" Text="{x:Bind PlayerViewModel.CurrentTrack.ArtistName, Mode=OneWay}" VerticalAlignment="Bottom" Margin="340, 0,0,40" FontSize="30"  Foreground="White" HorizontalAlignment="Left"  TextWrapping="NoWrap"   Width="600" FontWeight="Bold" />
                <local:RatingControlDarkControl x:Name="score" Value="{x:Bind PlayerViewModel.CurrentTrack.Score, Mode=TwoWay}" VerticalAlignment="Bottom" Margin="0, 0, 20, 50" Height="30" BorderThickness="0" HorizontalAlignment="Right" />
            </Grid>
        </Grid>
    </Grid>
</UserControl>
